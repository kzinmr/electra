FROM nvidia/cuda:10.2-cudnn7-runtime-ubuntu18.04

WORKDIR /app

ENV LANG=C.UTF-8

RUN apt-get update -y && apt-get install -y \
    git \
    wget \
    curl \
    cmake \
    unzip \
    gcc \
    g++ \
    python3-numpy python3-scipy python3-pip

RUN pip3 install --upgrade pip && \
    pip install tensorflow-gpu==1.15 tokenizers

COPY build_pretraining_dataset_hf.py tokenization_hf.py /app/

COPY model /app/model
COPY pretrain /app/pretrain
COPY util /app/util

COPY run_pretraining.sh run_pretraining.py configure_pretraining.py /app/
RUN mkdir -p outputs/models

CMD ["bash", "run_pretraining.sh"]